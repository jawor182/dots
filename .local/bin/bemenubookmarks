#!/bin/sh

bmfile=$HOME/keepassxc/bookmarks

selectbookmark() {
    selected=$(cat "$bmfile" | bemenu -i -l 30 -p "Select bookmark:"| cut -d ' ' -f 1)
    [ -z "$selected" ] && exit
    echo -n "$selected" | wl-copy
}

selectbookmark_browser() {
    selected=$(cat "$bmfile" | bemenu -i -l 30 -p "Select bookmark:"| cut -d ' ' -f 1)
    [ -z "$selected" ] && exit
    $BROWSER "$selected"
}

addbookmark(){
    bookmark=$(wl-paste);
    if [ "$bookmark" != "" ];then
        grep -x "$bookmark" "$bmfile" && notify-send "Bookmark is already in file" && exit 1 || echo "$bookmark" >> "$bmfile" && wl-copy ""
        notify-send "Added $bookmark to bookmarks"
    else
        notify-send "Empty clipboard!" && exit 1
    fi
}

case "$1" in
    select) selectbookmark;;
    select_browser) selectbookmark_browser;;
    add) addbookmark;;
esac
